# 技術スタック

## 概要

民泊・ゲストハウス予約サービスで採用する技術スタックとその選定理由。

---

## バックエンド

### Node.js + Express.js

**選定理由:**
1. **JavaScript/TypeScriptの統一**: フロントエンドと同じ言語で開発できるため、開発効率が向上
2. **豊富なエコシステム**: npmに多数のライブラリがあり、開発スピードが早い
3. **非同期I/O**: 多数の同時接続を効率的に処理できる
4. **学習コストの低さ**: 広く使われており、情報が豊富
5. **スケーラビリティ**: 水平スケールが容易

**バージョン:**
- Node.js: 20.x LTS
- Express.js: 4.x

**代替案と比較:**
- **NestJS**: より構造化されたフレームワークだが、初期の学習コストが高い
- **Fastify**: パフォーマンスは優れているが、エコシステムがExpressより小さい

### TypeScript

**選定理由:**
1. **型安全性**: コンパイル時にエラーを検出できる
2. **IDE補完**: 開発効率の向上
3. **保守性**: 大規模開発でもコードの品質を維持しやすい
4. **チーム開発**: 型定義により仕様が明確になる
5. **JavaScriptとの互換性**: 既存のJSライブラリをそのまま使用可能

**バージョン:**
- TypeScript: 5.x

### PostgreSQL

**選定理由:**
1. **リレーショナルDB**: 予約・施設・ユーザーなど関連性の高いデータに適している
2. **トランザクション**: 予約処理など整合性が重要な操作に必須
3. **JSONBサポート**: 柔軟なデータ構造にも対応可能
4. **全文検索**: 施設の検索機能に活用
5. **GIS拡張（PostGIS）**: 位置情報検索に対応可能
6. **実績と安定性**: 多くのプロダクションで使用されている

**バージョン:**
- PostgreSQL: 16.x

**代替案と比較:**
- **MySQL**: 広く使われているが、JSON処理やGIS機能がPostgreSQLより劣る
- **MongoDB**: スキーマレスで柔軟だが、トランザクションや複雑なリレーションが弱い

### Prisma ORM

**選定理由:**
1. **型安全**: TypeScriptとの相性が抜群
2. **マイグレーション**: スキーマ変更を安全に管理
3. **クエリビルダー**: SQLを書かずに複雑なクエリを構築可能
4. **自動生成**: スキーマから型定義を自動生成
5. **開発体験**: Prisma Studioでデータを視覚的に確認可能

**バージョン:**
- Prisma: 5.x

**代替案と比較:**
- **TypeORM**: 歴史が長いが、型安全性がPrismaより劣る
- **Sequelize**: 広く使われているが、TypeScript対応が不十分

### JWT (JSON Web Token)

**選定理由:**
1. **ステートレス**: サーバー側でセッションを保持する必要がない
2. **スケーラビリティ**: 複数のサーバーで負荷分散が容易
3. **標準化**: 広く採用されている標準規格
4. **クロスドメイン**: 異なるドメイン間での認証に対応
5. **ペイロード**: ユーザー情報を含めることができる

**ライブラリ:**
- jsonwebtoken
- bcrypt（パスワードハッシュ化）

**セキュリティ対策:**
- HttpOnly Cookie
- CSRF対策
- トークンのリフレッシュ機能
- 有効期限の設定

### その他のバックエンドライブラリ

| ライブラリ | 用途 | 選定理由 |
|----------|------|---------|
| express-validator | バリデーション | Express公式推奨、使いやすい |
| helmet | セキュリティヘッダー | セキュリティのベストプラクティスを自動適用 |
| cors | CORS設定 | フロントエンドとの通信に必須 |
| morgan | ログ | HTTPリクエストのロギング |
| winston | ログ | 構造化ログ、ファイル出力 |
| dotenv | 環境変数 | 環境ごとの設定管理 |
| multer | ファイルアップロード | 画像アップロードに使用 |
| sharp | 画像処理 | 画像のリサイズ・最適化 |
| date-fns | 日付処理 | 軽量で使いやすい |
| nodemailer | メール送信 | 確認メール、通知メール |

---

## フロントエンド

### Next.js 14 (App Router)

**選定理由:**
1. **React基盤**: 人気のあるReactフレームワーク
2. **SSR/SSG**: SEO対策とパフォーマンス最適化
3. **App Router**: 最新のルーティング、レイアウト、データフェッチ
4. **画像最適化**: Next.js Image による自動最適化
5. **TypeScript**: 標準でTypeScriptサポート
6. **Vercelとの統合**: デプロイが簡単
7. **開発体験**: Fast Refresh、エラー表示が優れている

**バージョン:**
- Next.js: 14.x
- React: 18.x

**代替案と比較:**
- **Vite + React**: ビルドは速いが、SSRの設定が複雑
- **Remix**: 新しいが、Next.jsよりエコシステムが小さい

### TypeScript

フロントエンドでも型安全性を確保するため、TypeScriptを採用。

### Tailwind CSS

**選定理由:**
1. **ユーティリティファースト**: 素早くスタイリング可能
2. **カスタマイズ性**: デザインシステムを容易に構築
3. **パフォーマンス**: 未使用のCSSを自動削除（PurgeCSS）
4. **レスポンシブ**: ブレークポイントが使いやすい
5. **メンテナンス**: クラス名を考える必要がない
6. **エコシステム**: プラグインが豊富

**バージョン:**
- Tailwind CSS: 3.x

**代替案と比較:**
- **CSS Modules**: スコープは安全だが、記述量が多い
- **Styled Components**: CSSinJSだが、ビルドサイズが大きい
- **MUI**: コンポーネントライブラリだが、カスタマイズが難しい

### Zustand

**選定理由:**
1. **シンプル**: Reduxより学習コストが低い
2. **軽量**: バンドルサイズが小さい（1KB未満）
3. **TypeScript**: 型安全性
4. **Redux DevTools**: デバッグツール対応
5. **ミドルウェア**: 永続化などの機能を追加可能

**バージョン:**
- Zustand: 4.x

**代替案と比較:**
- **Redux Toolkit**: 強力だが、ボイラープレートが多い
- **Jotai**: Atomicな状態管理だが、学習コストがある
- **Context API**: 小規模には十分だが、パフォーマンスに課題

### React Hook Form + Zod

**選定理由:**
1. **パフォーマンス**: 非制御コンポーネントで高速
2. **バリデーション**: Zodとの統合でスキーマベースのバリデーション
3. **TypeScript**: 完全な型サポート
4. **DX**: 使いやすいAPI
5. **エラーハンドリング**: 柔軟なエラー表示

**バージョン:**
- React Hook Form: 7.x
- Zod: 3.x

**代替案と比較:**
- **Formik**: 人気があるが、パフォーマンスがRHFより劣る
- **React Final Form**: 高機能だが、学習コストが高い

### Axios

**選定理由:**
1. **広く使われている**: 情報が豊富
2. **インターセプター**: リクエスト/レスポンスの共通処理
3. **エラーハンドリング**: 統一的なエラー処理
4. **キャンセル**: リクエストのキャンセル機能
5. **ブラウザ互換性**: 古いブラウザでも動作

**バージョン:**
- Axios: 1.x

**代替案と比較:**
- **Fetch API**: ネイティブだが、機能が少ない
- **React Query**: データフェッチ管理に優れているが、学習コストがある（将来導入検討）

### その他のフロントエンドライブラリ

| ライブラリ | 用途 | 選定理由 |
|----------|------|---------|
| date-fns | 日付処理 | 軽量、Tree-shakable |
| react-leaflet | 地図表示 | オープンソース、カスタマイズ可能 |
| react-day-picker | カレンダー | シンプル、カスタマイズ可能 |
| react-icons | アイコン | 豊富なアイコンセット |
| clsx | クラス名結合 | 条件付きクラス名の管理 |
| react-hot-toast | トースト通知 | シンプル、軽量 |
| framer-motion | アニメーション | 宣言的、使いやすい |

---

## インフラ・DevOps

### Vercel (フロントエンド)

**選定理由:**
1. **Next.js最適化**: Next.jsの開発元が提供
2. **自動デプロイ**: GitHubと連携して自動デプロイ
3. **プレビュー環境**: PR毎にプレビュー環境を自動生成
4. **Edge Network**: グローバルCDN
5. **無料枠**: 小規模開発に十分

**代替案と比較:**
- **Netlify**: Vercelと同等だが、Next.js最適化はVercelが上
- **AWS Amplify**: AWSエコシステムだが、設定が複雑

### Railway (バックエンド)

**選定理由:**
1. **簡単なデプロイ**: Herokuライクな使いやすさ
2. **PostgreSQL**: マネージドDBを提供（無期限）
3. **環境変数管理**: UI上で簡単に設定
4. **自動スケール**: トラフィックに応じて自動調整
5. **スリープなし**: 常時稼働で高速レスポンス
6. **開発・本番環境の統一**: 同じプラットフォームで管理可能

**採用:**
- Railway（本番環境推奨）

**代替案と比較:**
- **Render**: 固定料金だが、無料プランはスリープあり・90日でDB削除
- **Heroku**: 実績があるが、無料枠が廃止された
- **AWS EC2**: フルコントロール可能だが、管理コストが高い
- **DigitalOcean App Platform**: シンプルだが、機能がやや少ない

### GitHub Actions (CI/CD)

**選定理由:**
1. **GitHubとの統合**: リポジトリと同じ場所で管理
2. **無料枠**: パブリックリポジトリは無料
3. **豊富なアクション**: Marketplaceに多数のアクションがある
4. **柔軟性**: YAMLで柔軟に設定可能
5. **セキュリティ**: Secrets管理が組み込み

**代替案と比較:**
- **CircleCI**: 高機能だが、無料枠が小さい
- **GitLab CI**: GitLabを使う場合は最適だが、GitHub使用のため不要

### Cloudinary (画像ストレージ)

**選定理由:**
1. **CDN**: 世界中で高速配信
2. **画像変換**: URLで動的にリサイズ・最適化
3. **無料枠**: 月25GBまで無料
4. **API**: アップロード・管理が簡単
5. **最適化**: 自動でWebP変換など

**バージョン:**
- Cloudinary SDK

**代替案と比較:**
- **AWS S3 + CloudFront**: 強力だが、設定が複雑
- **Vercel Blob**: シンプルだが、画像変換機能が少ない

---

## 開発ツール

### ESLint + Prettier

**選定理由:**
1. **コード品質**: 潜在的なバグを検出
2. **統一性**: チーム全体でコードスタイルを統一
3. **自動修正**: 多くの問題を自動で修正
4. **Next.js設定**: Next.js推奨設定を使用

### Jest + React Testing Library

**選定理由:**
1. **標準**: Reactテストのデファクトスタンダード
2. **統合**: Next.jsと簡単に統合
3. **スナップショット**: UIテストが容易
4. **カバレッジ**: コードカバレッジを測定

### Playwright

**選定理由:**
1. **クロスブラウザ**: Chrome、Firefox、Safariで動作
2. **高速**: 並列実行が標準
3. **信頼性**: 自動待機機能で安定
4. **デバッグ**: UIモードでデバッグが容易
5. **Microsoftサポート**: 継続的な開発が期待できる

**代替案と比較:**
- **Cypress**: 使いやすいが、クロスブラウザ対応が弱い
- **Selenium**: 歴史があるが、設定が複雑

### Git + GitHub

**選定理由:**
1. **業界標準**: 最も広く使われているバージョン管理
2. **Pull Request**: コードレビューフロー
3. **Issues**: タスク管理
4. **Actions**: CI/CD統合

---

## データベース管理

### Prisma Migrate

**選定理由:**
1. **宣言的**: スキーマファイルから自動でマイグレーション生成
2. **型安全**: TypeScriptの型定義も自動生成
3. **ロールバック**: マイグレーションの巻き戻しが可能
4. **チーム開発**: スキーマの変更履歴を管理

### Prisma Studio

**選定理由:**
1. **GUI**: データベースを視覚的に管理
2. **開発効率**: 開発中のデータ確認・編集が容易
3. **無料**: Prismaに組み込み

---

## モニタリング・ログ

### Sentry (エラートラッキング)

**選定理由:**
1. **エラー検出**: リアルタイムでエラーを検出
2. **スタックトレース**: 詳細なエラー情報
3. **アラート**: エラー発生時に通知
4. **無料枠**: 月5,000イベントまで無料
5. **統合**: Next.js、Expressと簡単に統合

**代替案と比較:**
- **LogRocket**: セッション再生機能があるが、高価
- **Rollbar**: Sentryと同等だが、エコシステムが小さい

### Winston (ログ)

**選定理由:**
1. **構造化ログ**: JSONフォーマット
2. **レベル**: error, warn, info, debugなど
3. **トランスポート**: ファイル、コンソール、外部サービスに出力可能
4. **フィルタリング**: ログレベルで出力を制御

---

## セキュリティ

### helmet.js

HTTPセキュリティヘッダーの設定。

### express-rate-limit

レート制限によるDDoS対策。

### express-validator

入力バリデーションによるインジェクション対策。

### bcrypt

パスワードのハッシュ化。

---

## まとめ

| カテゴリ | 技術 | 理由 |
|---------|-----|------|
| バックエンド言語 | Node.js + TypeScript | 型安全、エコシステム、開発効率 |
| バックエンドフレームワーク | Express.js | シンプル、柔軟、実績 |
| データベース | PostgreSQL | リレーショナル、トランザクション、GIS |
| ORM | Prisma | 型安全、マイグレーション、DX |
| 認証 | JWT | ステートレス、スケーラブル |
| フロントエンド | Next.js 14 | SSR/SSG、SEO、DX |
| スタイリング | Tailwind CSS | 高速開発、カスタマイズ性 |
| 状態管理 | Zustand | シンプル、軽量、型安全 |
| フォーム | React Hook Form + Zod | パフォーマンス、バリデーション |
| HTTPクライアント | Axios | 機能豊富、エラーハンドリング |
| フロントエンドデプロイ | Vercel | Next.js最適化、自動デプロイ |
| バックエンドデプロイ | Railway/Render | 簡単、マネージドDB |
| CI/CD | GitHub Actions | 統合、無料、柔軟 |
| 画像ストレージ | Cloudinary | CDN、変換、無料枠 |
| エラートラッキング | Sentry | リアルタイム、詳細、無料枠 |
| テスト | Jest + Playwright | 標準、信頼性、DX |

この技術スタックは、**開発速度**、**保守性**、**スケーラビリティ**、**コスト**のバランスを考慮して選定しています。
